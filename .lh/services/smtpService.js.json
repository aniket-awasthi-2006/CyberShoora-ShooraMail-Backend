{
    "sourceFile": "services/smtpService.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1767454301572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767454306845,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,62 @@\n+import nodemailer from 'nodemailer';\r\n+import dotenv from 'dotenv';\r\n+import { saveSentEmail } from './imapService.js';\r\n+dotenv.config();\r\n+\r\n+const createTransporter = (authDetails) => {\r\n+    const auth = authDetails\r\n+        ? {\r\n+            user: authDetails.user,\r\n+            pass: authDetails.pass,\r\n+        }\r\n+        : {\r\n+            user: process.env.SITE_EMAIL,\r\n+            pass: process.env.SITE_PASSWORD,\r\n+        };\r\n+\r\n+    return nodemailer.createTransport({\r\n+        host: process.env.SMTP_HOST || 'smtp.stackmail.com',\r\n+        port: parseInt(process.env.SMTP_PORT) || 465,\r\n+        secure: process.env.SMTP_SECURE === 'true',\r\n+        tls: {\r\n+            rejectUnauthorized: false,\r\n+        },\r\n+        auth: auth,\r\n+    });\r\n+};\r\n+\r\n+const sendEmail = async (authDetails, mailOptions) => {\r\n+    const transporter = createTransporter(authDetails);\r\n+    return transporter.sendMail(mailOptions);\r\n+\r\n+};\r\n+\r\n+const replyEmail = async (authDetails, mailOptions) => {\r\n+    const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n+    const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n+\r\n+    const replyOptions = {\r\n+        ...mailOptions,\r\n+        subject: replySubject,\r\n+        text: replyBody,\r\n+    };\r\n+\r\n+    const transporter = createTransporter(authDetails);\r\n+    return transporter.sendMail(replyOptions);\r\n+};\r\n+\r\n+const forwardEmail = async (authDetails, mailOptions) => {\r\n+    const forwardSubject = mailOptions.subject.startsWith('Fwd: ') ? mailOptions.subject : `Fwd: ${mailOptions.subject}`;\r\n+    const forwardBody = `\\n\\n--- Forwarded Message ---\\n${mailOptions.text}`;\r\n+\r\n+    const forwardOptions = {\r\n+        ...mailOptions,\r\n+        subject: forwardSubject,\r\n+        text: forwardBody,\r\n+    };\r\n+\r\n+    const transporter = createTransporter(authDetails);\r\n+    return transporter.sendMail(forwardOptions);\r\n+};\r\n+\r\n+export { sendEmail, replyEmail, forwardEmail };\r\n"
                },
                {
                    "date": 1767454343513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,76 @@\n+import nodemailer from 'nodemailer';\r\n+import dotenv from 'dotenv';\r\n+import { saveSentEmail } from '../imapService.js';\r\n+dotenv.config();\r\n+\r\n+const createTransporter = (authDetails) => {\r\n+    const auth = authDetails\r\n+        ? {\r\n+            user: authDetails.user,\r\n+            pass: authDetails.pass,\r\n+        }\r\n+        : {\r\n+            user: process.env.SITE_EMAIL,\r\n+            pass: process.env.SITE_PASSWORD,\r\n+        };\r\n+\r\n+    return nodemailer.createTransport({\r\n+        host: process.env.SMTP_HOST || 'smtp.stackmail.com',\r\n+        port: parseInt(process.env.SMTP_PORT) || 465,\r\n+        secure: process.env.SMTP_SECURE === 'true',\r\n+        tls: {\r\n+            rejectUnauthorized: false,\r\n+        },\r\n+        auth: auth,\r\n+    });\r\n+};\r\n+\r\n+const sendEmail = async (authDetails, mailOptions) => {\r\n+    const transporter = createTransporter(authDetails);\r\n+    return transporter.sendMail(mailOptions);\r\n+\r\n+    try {\r\n+        await saveSentEmail(\r\n+            authDetails.user, // Assuming authDetails has the email/user\r\n+            authDetails.pass, // Assuming authDetails has the password\r\n+            mailOptions\r\n+        );\r\n+        console.log(\"Copy saved to Sent folder\");\r\n+    } catch (err) {\r\n+        // We log the error but don't throw it, because the email WAS actually sent to the recipient.\r\n+        // We don't want to tell the frontend \"Failed\" just because the copy wasn't saved.\r\n+        console.error(\"Email sent, but failed to save to Sent folder:\", err);\r\n+    }\r\n+\r\n+    return result;\r\n+};\r\n+\r\n+const replyEmail = async (authDetails, mailOptions) => {\r\n+    const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n+    const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n+\r\n+    const replyOptions = {\r\n+        ...mailOptions,\r\n+        subject: replySubject,\r\n+        text: replyBody,\r\n+    };\r\n+\r\n+    const transporter = createTransporter(authDetails);\r\n+    return transporter.sendMail(replyOptions);\r\n+};\r\n+\r\n+const forwardEmail = async (authDetails, mailOptions) => {\r\n+    const forwardSubject = mailOptions.subject.startsWith('Fwd: ') ? mailOptions.subject : `Fwd: ${mailOptions.subject}`;\r\n+    const forwardBody = `\\n\\n--- Forwarded Message ---\\n${mailOptions.text}`;\r\n+\r\n+    const forwardOptions = {\r\n+        ...mailOptions,\r\n+        subject: forwardSubject,\r\n+        text: forwardBody,\r\n+    };\r\n+\r\n+    const transporter = createTransporter(authDetails);\r\n+    return transporter.sendMail(forwardOptions);\r\n+};\r\n+\r\n+export { sendEmail, replyEmail, forwardEmail };\r\n"
                },
                {
                    "date": 1767454430202,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,82 +1,6 @@\n import nodemailer from 'nodemailer';\r\n import dotenv from 'dotenv';\r\n-import { saveSentEmail } from '../imapService.js';\r\n-dotenv.config();\r\n-\r\n-const createTransporter = (authDetails) => {\r\n-    const auth = authDetails\r\n-        ? {\r\n-            user: authDetails.user,\r\n-            pass: authDetails.pass,\r\n-        }\r\n-        : {\r\n-            user: process.env.SITE_EMAIL,\r\n-            pass: process.env.SITE_PASSWORD,\r\n-        };\r\n-\r\n-    return nodemailer.createTransport({\r\n-        host: process.env.SMTP_HOST || 'smtp.stackmail.com',\r\n-        port: parseInt(process.env.SMTP_PORT) || 465,\r\n-        secure: process.env.SMTP_SECURE === 'true',\r\n-        tls: {\r\n-            rejectUnauthorized: false,\r\n-        },\r\n-        auth: auth,\r\n-    });\r\n-};\r\n-\r\n-const sendEmail = async (authDetails, mailOptions) => {\r\n-    const transporter = createTransporter(authDetails);\r\n-    return transporter.sendMail(mailOptions);\r\n-\r\n-    try {\r\n-        await saveSentEmail(\r\n-            authDetails.user, // Assuming authDetails has the email/user\r\n-            authDetails.pass, // Assuming authDetails has the password\r\n-            mailOptions\r\n-        );\r\n-        console.log(\"Copy saved to Sent folder\");\r\n-    } catch (err) {\r\n-        // We log the error but don't throw it, because the email WAS actually sent to the recipient.\r\n-        // We don't want to tell the frontend \"Failed\" just because the copy wasn't saved.\r\n-        console.error(\"Email sent, but failed to save to Sent folder:\", err);\r\n-    }\r\n-\r\n-    return result;\r\n-};\r\n-\r\n-const replyEmail = async (authDetails, mailOptions) => {\r\n-    const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n-    const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n-\r\n-    const replyOptions = {\r\n-        ...mailOptions,\r\n-        subject: replySubject,\r\n-        text: replyBody,\r\n-    };\r\n-\r\n-    const transporter = createTransporter(authDetails);\r\n-    return transporter.sendMail(replyOptions);\r\n-};\r\n-\r\n-const forwardEmail = async (authDetails, mailOptions) => {\r\n-    const forwardSubject = mailOptions.subject.startsWith('Fwd: ') ? mailOptions.subject : `Fwd: ${mailOptions.subject}`;\r\n-    const forwardBody = `\\n\\n--- Forwarded Message ---\\n${mailOptions.text}`;\r\n-\r\n-    const forwardOptions = {\r\n-        ...mailOptions,\r\n-        subject: forwardSubject,\r\n-        text: forwardBody,\r\n-    };\r\n-\r\n-    const transporter = createTransporter(authDetails);\r\n-    return transporter.sendMail(forwardOptions);\r\n-};\r\n-\r\n-export { sendEmail, replyEmail, forwardEmail };\r\n-import nodemailer from 'nodemailer';\r\n-import dotenv from 'dotenv';\r\n import { saveSentEmail } from './imapService.js';\r\n dotenv.config();\r\n \r\n const createTransporter = (authDetails) => {\r\n@@ -104,9 +28,9 @@\n const sendEmail = async (authDetails, mailOptions) => {\r\n     const transporter = createTransporter(authDetails);\r\n     return transporter.sendMail(mailOptions);\r\n \r\n-};\r\n+    \r\n \r\n const replyEmail = async (authDetails, mailOptions) => {\r\n     const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n     const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n@@ -135,66 +59,4 @@\n     return transporter.sendMail(forwardOptions);\r\n };\r\n \r\n export { sendEmail, replyEmail, forwardEmail };\r\n-import nodemailer from 'nodemailer';\r\n-import dotenv from 'dotenv';\r\n-import { saveSentEmail } from './imapService.js';\r\n-dotenv.config();\r\n-\r\n-const createTransporter = (authDetails) => {\r\n-    const auth = authDetails\r\n-        ? {\r\n-            user: authDetails.user,\r\n-            pass: authDetails.pass,\r\n-        }\r\n-        : {\r\n-            user: process.env.SITE_EMAIL,\r\n-            pass: process.env.SITE_PASSWORD,\r\n-        };\r\n-\r\n-    return nodemailer.createTransport({\r\n-        host: process.env.SMTP_HOST || 'smtp.stackmail.com',\r\n-        port: parseInt(process.env.SMTP_PORT) || 465,\r\n-        secure: process.env.SMTP_SECURE === 'true',\r\n-        tls: {\r\n-            rejectUnauthorized: false,\r\n-        },\r\n-        auth: auth,\r\n-    });\r\n-};\r\n-\r\n-const sendEmail = async (authDetails, mailOptions) => {\r\n-    const transporter = createTransporter(authDetails);\r\n-    return transporter.sendMail(mailOptions);\r\n-\r\n-};\r\n-\r\n-const replyEmail = async (authDetails, mailOptions) => {\r\n-    const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n-    const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n-\r\n-    const replyOptions = {\r\n-        ...mailOptions,\r\n-        subject: replySubject,\r\n-        text: replyBody,\r\n-    };\r\n-\r\n-    const transporter = createTransporter(authDetails);\r\n-    return transporter.sendMail(replyOptions);\r\n-};\r\n-\r\n-const forwardEmail = async (authDetails, mailOptions) => {\r\n-    const forwardSubject = mailOptions.subject.startsWith('Fwd: ') ? mailOptions.subject : `Fwd: ${mailOptions.subject}`;\r\n-    const forwardBody = `\\n\\n--- Forwarded Message ---\\n${mailOptions.text}`;\r\n-\r\n-    const forwardOptions = {\r\n-        ...mailOptions,\r\n-        subject: forwardSubject,\r\n-        text: forwardBody,\r\n-    };\r\n-\r\n-    const transporter = createTransporter(authDetails);\r\n-    return transporter.sendMail(forwardOptions);\r\n-};\r\n-\r\n-export { sendEmail, replyEmail, forwardEmail };\r\n"
                },
                {
                    "date": 1767454440422,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,10 @@\n const sendEmail = async (authDetails, mailOptions) => {\r\n     const transporter = createTransporter(authDetails);\r\n     return transporter.sendMail(mailOptions);\r\n \r\n-    \r\n+  \r\n+};\r\n \r\n const replyEmail = async (authDetails, mailOptions) => {\r\n     const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n     const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n"
                }
            ],
            "date": 1767454301572,
            "name": "Commit-0",
            "content": "import nodemailer from 'nodemailer';\r\nimport dotenv from 'dotenv';\r\nimport { saveSentEmail } from './imapService.js';\r\ndotenv.config();\r\n\r\nconst createTransporter = (authDetails) => {\r\n    const auth = authDetails\r\n        ? {\r\n            user: authDetails.user,\r\n            pass: authDetails.pass,\r\n        }\r\n        : {\r\n            user: process.env.SITE_EMAIL,\r\n            pass: process.env.SITE_PASSWORD,\r\n        };\r\n\r\n    return nodemailer.createTransport({\r\n        host: process.env.SMTP_HOST || 'smtp.stackmail.com',\r\n        port: parseInt(process.env.SMTP_PORT) || 465,\r\n        secure: process.env.SMTP_SECURE === 'true',\r\n        tls: {\r\n            rejectUnauthorized: false,\r\n        },\r\n        auth: auth,\r\n    });\r\n};\r\n\r\nconst sendEmail = async (authDetails, mailOptions) => {\r\n    const transporter = createTransporter(authDetails);\r\n    return transporter.sendMail(mailOptions);\r\n\r\n};\r\n\r\nconst replyEmail = async (authDetails, mailOptions) => {\r\n    const replySubject = mailOptions.subject.startsWith('Re: ') ? mailOptions.subject : `Re: ${mailOptions.subject}`;\r\n    const replyBody = `\\n\\n--- Original Message ---\\n${mailOptions.text}`;\r\n\r\n    const replyOptions = {\r\n        ...mailOptions,\r\n        subject: replySubject,\r\n        text: replyBody,\r\n    };\r\n\r\n    const transporter = createTransporter(authDetails);\r\n    return transporter.sendMail(replyOptions);\r\n};\r\n\r\nconst forwardEmail = async (authDetails, mailOptions) => {\r\n    const forwardSubject = mailOptions.subject.startsWith('Fwd: ') ? mailOptions.subject : `Fwd: ${mailOptions.subject}`;\r\n    const forwardBody = `\\n\\n--- Forwarded Message ---\\n${mailOptions.text}`;\r\n\r\n    const forwardOptions = {\r\n        ...mailOptions,\r\n        subject: forwardSubject,\r\n        text: forwardBody,\r\n    };\r\n\r\n    const transporter = createTransporter(authDetails);\r\n    return transporter.sendMail(forwardOptions);\r\n};\r\n\r\nexport { sendEmail, replyEmail, forwardEmail };\r\n"
        }
    ]
}